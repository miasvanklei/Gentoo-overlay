diff --git a/dev-haskell/cpphs/cpphs-1.20.9.1.ebuild b/dev-haskell/cpphs/cpphs-1.20.9.1.ebuild
index 7afb12fc99..b16c982b83 100644
--- a/dev-haskell/cpphs/cpphs-1.20.9.1.ebuild
+++ b/dev-haskell/cpphs/cpphs-1.20.9.1.ebuild
@@ -24,3 +24,10 @@ RDEPEND="
 DEPEND="${RDEPEND}
 	>=dev-haskell/cabal-2.2.0.1
 "
+
+src_prepare() {
+	default
+
+        cabal_chdeps \
+                'time >=1.5 && <1.11' 'time >=1.5 && <1.12'
+}
diff --git a/dev-haskell/hls-class-plugin/hls-class-plugin-1.1.0.0.ebuild b/dev-haskell/hls-class-plugin/hls-class-plugin-1.1.0.0.ebuild
index 0e2e2d605c..9289aa44a8 100644
--- a/dev-haskell/hls-class-plugin/hls-class-plugin-1.1.0.0.ebuild
+++ b/dev-haskell/hls-class-plugin/hls-class-plugin-1.1.0.0.ebuild
@@ -18,7 +18,7 @@ KEYWORDS="~amd64 ~x86"
 RDEPEND="
 	dev-haskell/aeson:=[profile?]
 	dev-haskell/extra:=[profile?]
-	>=dev-haskell/ghc-exactprint-0.6.4:=[profile?] <dev-haskell/ghc-exactprint-1.1:=[profile?]
+	dev-haskell/ghc-exactprint:=[profile?]
 	>=dev-haskell/ghcide-1.8:=[profile?] <dev-haskell/ghcide-1.9:=[profile?]
 	dev-haskell/hls-graph:=[profile?]
 	>=dev-haskell/hls-plugin-api-1.5:=[profile?] <dev-haskell/hls-plugin-api-1.6:=[profile?]
diff --git a/dev-haskell/hls-hlint-plugin/hls-hlint-plugin-1.1.0.0.ebuild b/dev-haskell/hls-hlint-plugin/hls-hlint-plugin-1.1.0.0.ebuild
index 00f1200883..248cddf942 100644
--- a/dev-haskell/hls-hlint-plugin/hls-hlint-plugin-1.1.0.0.ebuild
+++ b/dev-haskell/hls-hlint-plugin/hls-hlint-plugin-1.1.0.0.ebuild
@@ -28,7 +28,6 @@ RDEPEND="
 	>=dev-haskell/diff-0.4.0:=[profile?] <dev-haskell/diff-0.5:=[profile?]
 	dev-haskell/extra:=[profile?]
 	>=dev-haskell/ghc-exactprint-0.6.3.4:=[profile?]
-	dev-haskell/ghc-lib-parser:=[profile?]
 	dev-haskell/ghc-lib-parser-ex:=[profile?]
 	>=dev-haskell/ghcide-1.8:=[profile?] <dev-haskell/ghcide-1.9:=[profile?]
 	dev-haskell/hashable:=[profile?]
@@ -43,6 +42,8 @@ RDEPEND="
 	dev-haskell/temporary:=[profile?]
 	dev-haskell/unordered-containers:=[profile?]
 	>=dev-lang/ghc-8.6.3:=
+	ghc-lib? ( >=dev-haskell/ghc-lib-parser-9.2:=[profile?] <dev-haskell/ghc-lib-parser-9.3:=[profile?] )
+	!ghc-lib? ( >=dev-lang/ghc-9.2:= <dev-lang/ghc-9.4:= )
 "
 DEPEND="${RDEPEND}
 	>=dev-haskell/cabal-2.4.0.1
@@ -54,6 +55,7 @@ DEPEND="${RDEPEND}
 
 src_configure() {
 	haskell-cabal_src_configure \
+		$(cabal_flag ghc-lib ghc-lib) \
 		--flag=-pedantic
 }
 
diff --git a/dev-haskell/hls-refactor-plugin/hls-refactor-plugin-1.0.0.0.ebuild b/dev-haskell/hls-refactor-plugin/hls-refactor-plugin-1.0.0.0.ebuild
index 86675b883f..ebac4234ff 100644
--- a/dev-haskell/hls-refactor-plugin/hls-refactor-plugin-1.0.0.0.ebuild
+++ b/dev-haskell/hls-refactor-plugin/hls-refactor-plugin-1.0.0.0.ebuild
@@ -25,7 +25,7 @@ RDEPEND="
 	dev-haskell/data-default:=[profile?]
 	dev-haskell/dlist:=[profile?]
 	dev-haskell/extra:=[profile?]
-	<dev-haskell/ghc-exactprint-1
+	dev-haskell/ghc-exactprint
 	>=dev-haskell/ghcide-1.8:=[profile?] <dev-haskell/ghcide-1.9:=[profile?]
 	dev-haskell/hls-graph:=[profile?]
 	>=dev-haskell/hls-plugin-api-1.3:=[profile?] <dev-haskell/hls-plugin-api-1.6:=[profile?]
diff --git a/dev-haskell/implicit-hie-cradle/implicit-hie-cradle-0.5.0.0.ebuild b/dev-haskell/implicit-hie-cradle/implicit-hie-cradle-0.5.0.0.ebuild
index 24d9e3faa6..4790e41730 100644
--- a/dev-haskell/implicit-hie-cradle/implicit-hie-cradle-0.5.0.0.ebuild
+++ b/dev-haskell/implicit-hie-cradle/implicit-hie-cradle-0.5.0.0.ebuild
@@ -30,3 +30,11 @@ RDEPEND="dev-haskell/base16-bytestring:=[profile?]
 DEPEND="${RDEPEND}
 	>=dev-haskell/cabal-2.2.0.1
 "
+
+src_prepare() {
+        default
+
+	cabal_chdeps \
+		'bytestring            >=0.10.8  && <0.11' 'bytestring            >=0.10.8  && <0.12' \
+		'time                  >=1.8.0   && <1.10' 'time                  >=1.8.0   && <1.12'
+}
diff --git a/dev-haskell/stylish-haskell/stylish-haskell-0.14.2.0.ebuild b/dev-haskell/stylish-haskell/stylish-haskell-0.14.2.0.ebuild
index 579ab9c18d..2a6a44877f 100644
--- a/dev-haskell/stylish-haskell/stylish-haskell-0.14.2.0.ebuild
+++ b/dev-haskell/stylish-haskell/stylish-haskell-0.14.2.0.ebuild
@@ -20,7 +20,6 @@ IUSE="ghc-lib"
 RDEPEND=">=dev-haskell/aeson-0.6:=[profile?] <dev-haskell/aeson-2.1:=[profile?]
 	>=dev-haskell/cabal-3.4:=[profile?] <dev-haskell/cabal-3.7:=[profile?]
 	>=dev-haskell/file-embed-0.0.10:=[profile?] <dev-haskell/file-embed-0.1:=[profile?]
-	>=dev-haskell/ghc-lib-parser-9.2:=[profile?] <dev-haskell/ghc-lib-parser-9.3:=[profile?]
 	>=dev-haskell/ghc-lib-parser-ex-9.2.0.3:=[profile?] <dev-haskell/ghc-lib-parser-ex-9.3:=[profile?]
 	>=dev-haskell/hsyaml-0.2.0:=[profile?] <dev-haskell/hsyaml-0.3:=[profile?]
 	>=dev-haskell/hsyaml-aeson-0.2.0:=[profile?] <dev-haskell/hsyaml-aeson-0.3:=[profile?]
@@ -28,6 +27,8 @@ RDEPEND=">=dev-haskell/aeson-0.6:=[profile?] <dev-haskell/aeson-2.1:=[profile?]
 	>=dev-haskell/strict-0.3:=[profile?] <dev-haskell/strict-0.5:=[profile?]
 	>=dev-haskell/syb-0.3:=[profile?] <dev-haskell/syb-0.8:=[profile?]
 	>=dev-lang/ghc-8.4.3:=
+	ghc-lib? ( >=dev-haskell/ghc-lib-parser-9.2:=[profile?] <dev-haskell/ghc-lib-parser-9.3:=[profile?] )
+	!ghc-lib? ( >=dev-lang/ghc-9.2:= <dev-lang/ghc-9.4:= )
 "
 DEPEND="${RDEPEND}
 	>=dev-haskell/cabal-2.4
diff --git a/dev-haskell/tagged/tagged-0.8.6.1.ebuild b/dev-haskell/tagged/tagged-0.8.6.1.ebuild
index b46b23d15e..3cc58e01a7 100644
--- a/dev-haskell/tagged/tagged-0.8.6.1.ebuild
+++ b/dev-haskell/tagged/tagged-0.8.6.1.ebuild
@@ -25,6 +25,16 @@ RDEPEND=">=dev-haskell/transformers-compat-0.5:=[profile?] <dev-haskell/transfor
 "
 DEPEND="${RDEPEND}"
 
+src_prepare() {
+        default
+        # ghc-patch it has awfully unportable (across cabal versions) ghc detection code
+        # but in gentoo we install it to fixed patch, so remove Setup.hs detection code
+        cabal-mksetup
+
+        cabal_chdeps \
+		'template-haskell >= 2.8 && < 2.18' 'template-haskell >= 2.8 && < 2.19'
+}
+
 src_configure() {
 	haskell-cabal_src_configure \
 		--flag=deepseq \
diff --git a/eclass/ghc-package.eclass b/eclass/ghc-package.eclass
index 156ee372f3..ee5d208e32 100644
--- a/eclass/ghc-package.eclass
+++ b/eclass/ghc-package.eclass
@@ -58,11 +58,11 @@ ghc-getghcpkg() {
 # because for some reason the global package file
 # must be specified
 ghc-getghcpkgbin() {
-	local empty_db="${T}/empty.conf.d" ghc_pkg="$(ghc-libdir)/bin/ghc-pkg"
+	local empty_db="${T}/empty.conf.d" ghc_pkg="$(ghc-libdir)/../bin/ghc-pkg"
 	if [[ ! -d ${empty_db} ]]; then
 		"${ghc_pkg}" init "${empty_db}" || die "Failed to initialize empty global db"
 	fi
-	echo "$(ghc-libdir)/bin/ghc-pkg" "--global-package-db=${empty_db}"
+	echo "$(ghc-libdir)/../bin/ghc-pkg" "--global-package-db=${empty_db}"
 }
 
 # @FUNCTION: ghc-version
