--- include/sys/sysmacros.h.bak	2015-07-12 21:25:51.334959440 +0000
+++ include/sys/sysmacros.h	2015-07-12 21:27:03.284758709 +0000
@@ -1,15 +1,13 @@
 #ifndef _SYS_SYSMACROS_H
 #define _SYS_SYSMACROS_H
 
-#define major(x) \
-	((unsigned)( (((x)>>31>>1) & 0xfffff000) | (((x)>>8) & 0x00000fff) ))
-#define minor(x) \
-	((unsigned)( (((x)>>12) & 0xffffff00) | ((x) & 0x000000ff) ))
+extern unsigned int gnu_dev_major (unsigned long long int __dev);
+extern unsigned int gnu_dev_minor (unsigned long long int __dev);
+extern unsigned long long int gnu_dev_makedev (unsigned int __major,
+                                               unsigned int __minor);
 
-#define makedev(x,y) ( \
-        (((x)&0xfffff000ULL) << 32) | \
-	(((x)&0x00000fffULL) << 8) | \
-        (((y)&0xffffff00ULL) << 12) | \
-	(((y)&0x000000ffULL)) )
+#define major(x) gnu_dev_major(x)
+#define minor(x) gnu_dev_minor(x)
+#define makedev(x,y) gnu_dev_makedev(x,y)
 
 #endif
--- /dev/null	2015-07-12 07:21:19.339145755 +0000
+++ src/temp/makedev.c	2015-07-12 21:28:26.435524607 +0000
@@ -0,0 +1,25 @@
+#include <endian.h>
+#include <sys/sysmacros.h>
+
+unsigned int
+gnu_dev_major (unsigned long long int dev)
+{
+  return ((unsigned int)( ((dev >> 31 >> 1) & 0xfffff000)
+          | ((dev >> 8) & 0x00000fff) ));
+}
+
+unsigned int
+gnu_dev_minor (unsigned long long int dev)
+{
+  return ((unsigned int)( ((dev >> 12) & 0xffffff00)
+          | (dev & 0x000000ff) ));
+}
+
+unsigned long long int
+gnu_dev_makedev (unsigned int major, unsigned int minor)
+{
+  return (((major & 0xfffff000ULL) << 32)
+          | ((major & 0x00000fffULL) << 8)
+          | ((minor & 0xffffff00ULL) << 12)
+          | (minor & 0x000000ffULL));
+}
