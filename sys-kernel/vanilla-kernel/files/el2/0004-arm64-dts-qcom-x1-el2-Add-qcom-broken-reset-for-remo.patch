From a2c5d69c0fd20bb9d4f50b94cf3eceec287ad35b Mon Sep 17 00:00:00 2001
From: Stephan Gerhold <stephan@gerhold.net>
Date: Wed, 30 Jul 2025 16:17:46 +0200
Subject: [PATCH 102/150] arm64: dts: qcom: x1-el2: Add qcom,broken-reset for
 remoteprocs

The remoteproc PAS firmware interface does not work properly when running
bare-metal without hypervisor in EL2. It's possible to authenticate and
start new firmware, but the remoteproc is never actually brought out of
reset. On X1E this affects all remoteprocs: ADSP and CDSP.

Mark both with "qcom,broken-reset" to make the driver skip trying to reset
the remoteproc. We can still attach to them if they are already running
during boot. On X1E, the "lite" ADSP firmware should be always running
already during boot, and it provides at least battery status/charging as
well as USB-C detection for external displays.

Signed-off-by: Stephan Gerhold <stephan@gerhold.net>
Signed-off-by: Abel Vesa <abel.vesa@oss.qualcomm.com>
---
 arch/arm64/boot/dts/qcom/x1-el2.dtso | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/arch/arm64/boot/dts/qcom/x1-el2.dtso b/arch/arm64/boot/dts/qcom/x1-el2.dtso
index 0cfee4421..1a821f1de 100644
--- a/arch/arm64/boot/dts/qcom/x1-el2.dtso
+++ b/arch/arm64/boot/dts/qcom/x1-el2.dtso
@@ -54,6 +54,14 @@ &pcie_smmu {
 	status = "okay";
 };
 
+&remoteproc_adsp {
+	qcom,broken-reset;
+};
+
+&remoteproc_cdsp {
+	qcom,broken-reset;
+};
+
 /*
  * The "SBSA watchdog" is implemented in software in Gunyah
  * and can't be used when running in EL2.
-- 
2.52.0

