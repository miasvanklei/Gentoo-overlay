diff --git a/app/Main.hs b/app/Main.hs
index 3e145ad..b996497 100644
--- a/app/Main.hs
+++ b/app/Main.hs
@@ -125,8 +125,7 @@ optsParserInfo =
               showVersion version,
               $gitBranch,
               $gitHash
-            ],
-          "using ghc-lib-parser " ++ VERSION_ghc_lib_parser
+            ]
         ]
     exts :: Parser (a -> a)
     exts =
diff --git a/ormolu.cabal b/ormolu.cabal
index 84dca68..26eec2e 100644
--- a/ormolu.cabal
+++ b/ormolu.cabal
@@ -61,6 +61,11 @@ flag dev
   manual:             True
   default:            False
 
+flag ghc-lib
+  default: False
+  manual: True
+  description: Force dependency on ghc-lib-parser even if GHC API in the ghc package is supported
+
 library
   hs-source-dirs:     src
   build-depends:      base           >= 4.12 && < 5.0
@@ -68,10 +73,18 @@ library
                     , containers     >= 0.5 && < 0.7
                     , dlist          >= 0.8 && < 0.9
                     , exceptions     >= 0.6 && < 0.11
-                    , ghc-lib-parser >= 8.10 && < 8.11
                     , mtl            >= 2.0 && < 3.0
                     , syb            >= 0.7 && < 0.8
                     , text           >= 0.2 && < 1.3
+  if !flag(ghc-lib) && impl(ghc >= 8.10.0) && impl(ghc < 8.11.0)
+    build-depends:
+      ghc == 8.10.*,
+      ghc-boot-th,
+      ghc-boot
+  else
+    build-depends:
+      ghc-lib-parser == 8.10.*
+
   exposed-modules:    Ormolu
                     , Ormolu.Config
                     , Ormolu.Diff
@@ -149,11 +162,18 @@ executable ormolu
   main-is:            Main.hs
   hs-source-dirs:     app
   build-depends:      base           >= 4.12 && < 5.0
-                    , ghc-lib-parser >= 8.10 && < 8.11
                     , gitrev         >= 1.3 && < 1.4
                     , optparse-applicative >= 0.14 && < 0.16
                     , ormolu
                     , text           >= 0.2 && < 1.3
+ if !flag(ghc-lib) && impl(ghc >= 8.10.0) && impl(ghc < 8.11.0)
+   build-depends:
+     ghc == 8.10.*,
+     ghc-boot-th,
+     ghc-boot
+ else
+   build-depends:
+     ghc-lib-parser == 8.10.*
   other-modules:      Paths_ormolu
   if flag(dev)
     ghc-options:      -Wall -Werror -Wcompat
