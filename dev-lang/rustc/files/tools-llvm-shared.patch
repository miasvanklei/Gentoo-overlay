--- a/src/bootstrap/tool.rs
+++ b/src/bootstrap/tool.rs
@@ -426,6 +426,10 @@
         cargo.env("RUSTC_DEBUGINFO", builder.config.rust_debuginfo.to_string())
              .env("RUSTC_DEBUGINFO_LINES", builder.config.rust_debuginfo_lines.to_string());
 
+       if build.config.llvm_link_shared {
+            cargo.env("LLVM_LINK_SHARED", "1");
+        }
+
         let _folder = build.fold_output(|| format!("stage{}-rustdoc", target_compiler.stage));
         println!("Building rustdoc for stage{} ({})", target_compiler.stage, target_compiler.host);
         build.run(&mut cargo);
--- a/src/tools/rustdoc/Cargo.toml
+++ b/src/tools/rustdoc/Cargo.toml
@@ -12,3 +12,4 @@ path = "main.rs"
 
 [dependencies]
 rustdoc = { path = "../../librustdoc" }
+rustc_llvm = { path = "../../librustc_llvm" }
--- a/src/tools/rustdoc/main.rs
+++ b/src/tools/rustdoc/main.rs
@@ -9,5 +9,6 @@
 // except according to those terms.
 
 extern crate rustdoc;
+extern crate rustc_llvm;
 
 fn main() { rustdoc::main() }
--- a/src/tools/rls/Cargo.toml
+++ b/src/tools/rls/Cargo.toml
@@ -22,6 +22,7 @@
 rls-rustc = "0.2.1"
 rls-span = { version = "0.4", features = ["serialize-serde"] }
 rls-vfs = { version = "0.4.5", features = ["racer-impls"] }
+rustc_llvm = { path = "../../librustc_llvm" }
 rustfmt-nightly = "0.4.0"
 clippy_lints = { version = "0.0.189", optional = true }
 serde = "1.0"
--- a/src/tools/rls/src/main.rs
+++ b/src/tools/rls/src/main.rs
@@ -14,6 +14,8 @@
 #![feature(integer_atomics)]
 #![feature(fnbox)]
 
+extern crate rustc_llvm;
+
 extern crate cargo;
 extern crate env_logger;
 extern crate languageserver_types as ls_types;
--- a/src/tools/clippy/Cargo.toml	2018-01-01 22:52:59.000000000 +0100
+++ b/src/tools/clippy/Cargo.toml	2018-01-06 17:51:36.848306374 +0100
@@ -41,6 +41,7 @@
 # end automatic update
 regex = "0.2"
 semver = "0.9"
+rustc_llvm = { path = "../../librustc_llvm" }
 
 [dev-dependencies]
 compiletest_rs = "0.3"
--- a/src/tools/clippy/src/main.rs	2018-01-01 22:52:59.000000000 +0100
+++ b/src/tools/clippy/src/main.rs	2018-01-06 17:52:05.185239927 +0100
@@ -3,6 +3,8 @@
 #![feature(rustc_private)]
 #![allow(unknown_lints, missing_docs_in_private_items)]
 
+extern crate rustc_llvm;
+
 const CARGO_CLIPPY_HELP: &str = r#"Checks a package to catch common mistakes and improve your Rust code.
 
 Usage:
