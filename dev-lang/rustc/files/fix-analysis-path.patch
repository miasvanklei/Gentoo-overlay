--- a/src/vendor/rls-analysis/src/loader.rs	2018-02-12 21:28:26.000000000 +0100
+++ b/src/vendor/rls-analysis/src/loader.rs	2018-02-16 11:51:03.433552741 +0100
@@ -83,36 +83,15 @@
             .join("deps")
             .join("save-analysis");
         let sys_root_path = sys_root_path();
-        let target_triple = extract_target_triple(sys_root_path.as_path());
         let libs_path = sys_root_path
             .join("lib")
             .join("rustlib")
-            .join(&target_triple)
             .join("analysis");
 
         vec![libs_path, deps_path, principle_path]
     }
 }
 
-// FIXME: This can fail when using a custom toolchain in rustup (often linked to
-// `/$rust_repo/build/$target/stage2`)
-fn extract_target_triple(sys_root_path: &Path) -> String {
-    // Extracts nightly-x86_64-pc-windows-msvc from
-    // $HOME/.rustup/toolchains/nightly-x86_64-pc-windows-msvc
-    let toolchain = sys_root_path
-        .iter()
-        .last()
-        .and_then(OsStr::to_str)
-        .expect("extracting toolchain failed");
-    // Extracts x86_64-pc-windows-msvc from nightly-x86_64-pc-windows-pc
-    let triple = toolchain
-        .splitn(2, '-')
-        .last()
-        .map(String::from)
-        .expect("extracting triple failed");
-    triple
-}
-
 fn sys_root_path() -> PathBuf {
     env::var("SYSROOT")
         .ok()
--- a/src/vendor/rls-analysis/.cargo-checksum.json	2018-02-16 12:23:16.304116156 +0100
+++ b/src/vendor/rls-analysis/.cargo-checksum.json	2018-02-16 12:23:51.662035179 +0100
@@ -1 +1 @@
-{"files":{".cargo-ok":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",".gitignore":"9507c2ad1861cc4599474f2fa645a0938dfb381b8c79e307ce1b44780cf10fcd",".travis.yml":"79a4b8dfb1f76bb1fb7126679109a5326fbd2bcadc69765ef98cb431a90a02a4","Cargo.toml":"9a80d0d1dbfab26c13f42bb938a9322d9f7e0657a42c7ec672abc9556c109ffb","Cargo.toml.orig":"890d50dade0dc975224274a10d400e98922a3badef516d73a8014790a36efd7c","README.md":"3f8b7e6f924b74fdc7affa314d3b029090c4838c63d3420e8d6b3aa6eff448d2","benches/std_api_crate.rs":"d74c62201b6c9fc13a63acdc6c7013bf618633e8b0965a802315ca516f56742f","src/analysis.rs":"25172a03adef3e8418c415f432fafe259a400f0080c188ab8551a4de6bcfe1a2","src/lib.rs":"cafdd5a8dc57d39b1362d9d919f346dd3090bcc2dad71b0f1a4b6cc5313ed57d","src/listings/mod.rs":"b3cd49cd4ef69352f79a9a5302bde9d72c5ad192b0c06c4c1a1f1ad6dccd3f99","src/loader.rs":"94fab1970b1fc0c8a4fb9ef9b2bdaa3d9dd3f6d136313e8d6076989916b6ee83","src/lowering.rs":"90efbf24f67aec3cee5d3a7d3e8b719ecef1df6c16f10d940ebe1793b7b06635","src/raw.rs":"0efb9cb129d310546317ac6d0639274862583363a3be8fe4a3f5d1e86b8e18cc","src/test/mod.rs":"bdc56d5851ad7d8b107f346950c3caf2e3a97a05e8144d702b33485de18dd2f6","src/util.rs":"2b6a2a5a46f948818bafd616619242d11161971001b94a15dc071c8c43188047","test_data/make_data.sh":"a1ba1aa1b4b3a3b9a2f8f15d38e18ed66b5fd0ee9ab653b701ef9f25669ea243","test_data/rls-analysis/libderive_new-bde12847971b287b.json":"4fa0784f901b636a0bb14d5c7d6f9611d42d0f516edc069cf8a1c4102eecb4e7","test_data/rls-analysis/liblog-d22cd0932fa5c1b3.json":"c44cba7be779d4e9150dc2344576d8dc4f0a1908b1b42d58ef87d64b70524a83","test_data/rls-analysis/libquote-b3cf046a798c19b3.json":"d9e33b7c9aa30fe09ddeae32cc726b79ea3afcac36a2c034dc8f497556f9adbf","test_data/rls-analysis/librls_analysis-b3dec921ecc459d1.json":"94046ef205bd1cbef485cf0ccae5b28e52c5828de8aa42b9c0d72bd1f4c78e68","test_data/rls-analysis/librls_analysis-d50749ac6b175c47.json":"b7bcc2c05cd0cf1697bf46da27d2ec007a454913d0437a57613b2cdd8f9f1a9b","test_data/rls-analysis/librls_data-b0b0e86828c2c73b.json":"6f3c72a3e1de26bd7dedc8958a31162528a86033461da12a084a02460b9840a7","test_data/rls-analysis/librls_data-fb652b43586148ed.json":"df58e0be79eff37ba5a7c03ef65550c787d884cc27f667b500a6b4135b5c133a","test_data/rls-analysis/librls_span-38da590cd9f4aa4f.json":"70d449552dec04645c76cbf04a9dbb000e344eb6f8db55f078ccde9c755c5a02","test_data/rls-analysis/librustc_serialize-058bf7df90949d13.json":"a79dd36d85e71d79477649e47a616603cd746a20f31af7d233beb1125a32359c","test_data/rls-analysis/libsyn-e39deb67629c1e59.json":"5f0aabd1f3b0eb1e8dc278ede0f0ca57bdae58215784844bb313b697380df364","test_data/rls-analysis/libunicode_xid-e5925768ebe85568.json":"e69954634f920c998b1aab83095505656b68eb4354adee5edcf21d66ac39befb","test_data/rust-analysis/liballoc-bad119b0f880de53.json":"8fde9d51e445162b9a241c7dde4296442bd5942b72528330e7371fe3d6e13d97","test_data/rust-analysis/liballoc_jemalloc-008832e27c24f450.json":"7ae1a0c513deba43acab66d283ef19fa0c0ec97f4182ea4d97100569a270c718","test_data/rust-analysis/liballoc_system-9ff2c67f40fe5858.json":"7bb3468d67fa010935a375758f3216030e026b99e2c78aa56df6a84021c7db0a","test_data/rust-analysis/libcompiler_builtins-709204c2e3fe5ec9.json":"f9f0424d7341bc442418a862c699fda2073beaaa738ae707504c212bff497c3b","test_data/rust-analysis/libcore-f61c023fb8fcfea8.json":"ebf55d6b4be66bf1688f3acf94df78912dae36f1517e1605fac638c0af53764d","test_data/rust-analysis/liblibc-e1c7eeeb00260d82.json":"4ebeb94b3d63b39de88a5c03873f037c36999eedacc25425d9e8f26fdee4d0ac","test_data/rust-analysis/libpanic_abort-e9dd47ab30424812.json":"f8f056cb8208c5d714eca4d99dd2a6344d634a107d297602c9fc7d886cc6cbd4","test_data/rust-analysis/libpanic_unwind-5bef2c52ac19d279.json":"560d67a97dc194003053dcf26150b48de58a137387d9c7bedad3174c87385ada","test_data/rust-analysis/librand-efb9ae917b0ef713.json":"c4aa2a5b0529ceb38e1a83dbc61aa0ae5bacdd4653a8ef8330f57e910a604cee","test_data/rust-analysis/librustc_asan-6cc0b1c9c75098b7.json":"694d98e550c98659cad52d8032dc8c9686cc5d7ade49197439ffaba89f5635fe","test_data/rust-analysis/librustc_lsan-c862dc06a5d9808f.json":"f1dbb827aadf2874a6c2f0b64b936704faeaff8cb6ca7849e891ab427901983a","test_data/rust-analysis/librustc_msan-2dca84f1bc79826a.json":"4a0f339f309418002af5da50e6ec4305ad8c4db6c007517b0f89631cad571d21","test_data/rust-analysis/librustc_tsan-139258d4a22383b3.json":"49121ec1262723a3a3c4a9fc9e08447355822703949a841b689596e23f1875e3","test_data/rust-analysis/libstd-a5c162a67a9eb065.json":"dcfe81b40d0dd1fd336b4bfbc538a0fe1af4a3507817015fb7fc36aa7c6b8ace","test_data/rust-analysis/libstd_unicode-c87147d9878a34a6.json":"fec067380d0f0a40f513aa2ab95f973bd51a59ede21e4a7c8030d72889be06e9","test_data/rust-analysis/libunwind-3830ae5679a0b739.json":"f8c826708744cdd47373e46a288a1a70de2a4b7372d39fea92b3c3df9790a4a6"},"package":"38841e3c5271715a574ac220d9b408b59ed9e2626909c3bc54b5853b4eaadb7b"}
\ No newline at end of file
+{"files":{".cargo-ok":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",".gitignore":"9507c2ad1861cc4599474f2fa645a0938dfb381b8c79e307ce1b44780cf10fcd",".travis.yml":"79a4b8dfb1f76bb1fb7126679109a5326fbd2bcadc69765ef98cb431a90a02a4","Cargo.toml":"9a80d0d1dbfab26c13f42bb938a9322d9f7e0657a42c7ec672abc9556c109ffb","Cargo.toml.orig":"890d50dade0dc975224274a10d400e98922a3badef516d73a8014790a36efd7c","README.md":"3f8b7e6f924b74fdc7affa314d3b029090c4838c63d3420e8d6b3aa6eff448d2","benches/std_api_crate.rs":"d74c62201b6c9fc13a63acdc6c7013bf618633e8b0965a802315ca516f56742f","src/analysis.rs":"25172a03adef3e8418c415f432fafe259a400f0080c188ab8551a4de6bcfe1a2","src/lib.rs":"cafdd5a8dc57d39b1362d9d919f346dd3090bcc2dad71b0f1a4b6cc5313ed57d","src/listings/mod.rs":"b3cd49cd4ef69352f79a9a5302bde9d72c5ad192b0c06c4c1a1f1ad6dccd3f99","src/loader.rs":"7f6e17ddf0d58ba71c394194de57e4cd05a1c9ddc8659856ec29558a0594ec20","src/lowering.rs":"90efbf24f67aec3cee5d3a7d3e8b719ecef1df6c16f10d940ebe1793b7b06635","src/raw.rs":"0efb9cb129d310546317ac6d0639274862583363a3be8fe4a3f5d1e86b8e18cc","src/test/mod.rs":"bdc56d5851ad7d8b107f346950c3caf2e3a97a05e8144d702b33485de18dd2f6","src/util.rs":"2b6a2a5a46f948818bafd616619242d11161971001b94a15dc071c8c43188047","test_data/make_data.sh":"a1ba1aa1b4b3a3b9a2f8f15d38e18ed66b5fd0ee9ab653b701ef9f25669ea243","test_data/rls-analysis/libderive_new-bde12847971b287b.json":"4fa0784f901b636a0bb14d5c7d6f9611d42d0f516edc069cf8a1c4102eecb4e7","test_data/rls-analysis/liblog-d22cd0932fa5c1b3.json":"c44cba7be779d4e9150dc2344576d8dc4f0a1908b1b42d58ef87d64b70524a83","test_data/rls-analysis/libquote-b3cf046a798c19b3.json":"d9e33b7c9aa30fe09ddeae32cc726b79ea3afcac36a2c034dc8f497556f9adbf","test_data/rls-analysis/librls_analysis-b3dec921ecc459d1.json":"94046ef205bd1cbef485cf0ccae5b28e52c5828de8aa42b9c0d72bd1f4c78e68","test_data/rls-analysis/librls_analysis-d50749ac6b175c47.json":"b7bcc2c05cd0cf1697bf46da27d2ec007a454913d0437a57613b2cdd8f9f1a9b","test_data/rls-analysis/librls_data-b0b0e86828c2c73b.json":"6f3c72a3e1de26bd7dedc8958a31162528a86033461da12a084a02460b9840a7","test_data/rls-analysis/librls_data-fb652b43586148ed.json":"df58e0be79eff37ba5a7c03ef65550c787d884cc27f667b500a6b4135b5c133a","test_data/rls-analysis/librls_span-38da590cd9f4aa4f.json":"70d449552dec04645c76cbf04a9dbb000e344eb6f8db55f078ccde9c755c5a02","test_data/rls-analysis/librustc_serialize-058bf7df90949d13.json":"a79dd36d85e71d79477649e47a616603cd746a20f31af7d233beb1125a32359c","test_data/rls-analysis/libsyn-e39deb67629c1e59.json":"5f0aabd1f3b0eb1e8dc278ede0f0ca57bdae58215784844bb313b697380df364","test_data/rls-analysis/libunicode_xid-e5925768ebe85568.json":"e69954634f920c998b1aab83095505656b68eb4354adee5edcf21d66ac39befb","test_data/rust-analysis/liballoc-bad119b0f880de53.json":"8fde9d51e445162b9a241c7dde4296442bd5942b72528330e7371fe3d6e13d97","test_data/rust-analysis/liballoc_jemalloc-008832e27c24f450.json":"7ae1a0c513deba43acab66d283ef19fa0c0ec97f4182ea4d97100569a270c718","test_data/rust-analysis/liballoc_system-9ff2c67f40fe5858.json":"7bb3468d67fa010935a375758f3216030e026b99e2c78aa56df6a84021c7db0a","test_data/rust-analysis/libcompiler_builtins-709204c2e3fe5ec9.json":"f9f0424d7341bc442418a862c699fda2073beaaa738ae707504c212bff497c3b","test_data/rust-analysis/libcore-f61c023fb8fcfea8.json":"ebf55d6b4be66bf1688f3acf94df78912dae36f1517e1605fac638c0af53764d","test_data/rust-analysis/liblibc-e1c7eeeb00260d82.json":"4ebeb94b3d63b39de88a5c03873f037c36999eedacc25425d9e8f26fdee4d0ac","test_data/rust-analysis/libpanic_abort-e9dd47ab30424812.json":"f8f056cb8208c5d714eca4d99dd2a6344d634a107d297602c9fc7d886cc6cbd4","test_data/rust-analysis/libpanic_unwind-5bef2c52ac19d279.json":"560d67a97dc194003053dcf26150b48de58a137387d9c7bedad3174c87385ada","test_data/rust-analysis/librand-efb9ae917b0ef713.json":"c4aa2a5b0529ceb38e1a83dbc61aa0ae5bacdd4653a8ef8330f57e910a604cee","test_data/rust-analysis/librustc_asan-6cc0b1c9c75098b7.json":"694d98e550c98659cad52d8032dc8c9686cc5d7ade49197439ffaba89f5635fe","test_data/rust-analysis/librustc_lsan-c862dc06a5d9808f.json":"f1dbb827aadf2874a6c2f0b64b936704faeaff8cb6ca7849e891ab427901983a","test_data/rust-analysis/librustc_msan-2dca84f1bc79826a.json":"4a0f339f309418002af5da50e6ec4305ad8c4db6c007517b0f89631cad571d21","test_data/rust-analysis/librustc_tsan-139258d4a22383b3.json":"49121ec1262723a3a3c4a9fc9e08447355822703949a841b689596e23f1875e3","test_data/rust-analysis/libstd-a5c162a67a9eb065.json":"dcfe81b40d0dd1fd336b4bfbc538a0fe1af4a3507817015fb7fc36aa7c6b8ace","test_data/rust-analysis/libstd_unicode-c87147d9878a34a6.json":"fec067380d0f0a40f513aa2ab95f973bd51a59ede21e4a7c8030d72889be06e9","test_data/rust-analysis/libunwind-3830ae5679a0b739.json":"f8c826708744cdd47373e46a288a1a70de2a4b7372d39fea92b3c3df9790a4a6"},"package":"38841e3c5271715a574ac220d9b408b59ed9e2626909c3bc54b5853b4eaadb7b"}
--- a/src/bootstrap/bootstrap.py	2018-02-16 12:24:46.197909788 +0100
+++ b/src/bootstrap/bootstrap.py	2018-02-16 12:24:58.275882228 +0100
@@ -618,10 +618,6 @@
             args.append("--verbose")
             if self.verbose > 1:
                 args.append("--verbose")
-        if self.use_locked_deps:
-            args.append("--locked")
-        if self.use_vendored_sources:
-            args.append("--frozen")
         run(args, env=env, verbose=self.verbose)
 
     def build_triple(self):
